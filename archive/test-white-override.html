<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Feh√©r Fest√©k √ñbl√≠t√©s Teszt - Piros Folt Elt√ºntet√©se</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            overflow-x: hidden;
        }

        .debug-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.85);
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-width: 350px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        .debug-panel h3 {
            margin-top: 0;
            color: #00ffff;
            font-size: 14px;
        }

        .debug-item {
            margin: 8px 0;
            padding: 5px;
            background: rgba(0, 255, 255, 0.1);
            border-left: 3px solid #00ffff;
        }

        .debug-item.success {
            border-left-color: #00ff00;
        }

        .debug-item.error {
            border-left-color: #ff0000;
            color: #ff6666;
        }

        .debug-item.warning {
            border-left-color: #ffaa00;
            color: #ffcc66;
        }

        .test-content {
            position: relative;
            z-index: 10;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(10px);
            margin: 40px auto;
            padding: 40px;
            border-radius: 15px;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
            margin-top: 0;
        }

        .badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        .badge.success {
            background: #4CAF50;
        }

        .info-box {
            background: rgba(103, 126, 234, 0.1);
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }

        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        ul {
            line-height: 1.8;
        }

        .timeline {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 5px;
        }

        .timeline-item {
            margin: 10px 0;
            padding: 10px;
            border-left: 3px solid #667eea;
            background: white;
        }

        .timeline-item strong {
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Debug panel -->
    <div class="debug-panel" id="debugPanel">
        <h3>üîç Debug Console</h3>
        <div id="debugLog"></div>
    </div>

    <!-- Test tartalom -->
    <div class="test-content">
        <h1>üßπ Feh√©r Fest√©k √ñbl√≠t√©s <span class="badge success">Piros folt fix</span></h1>

        <div class="info-box">
            <strong>‚úÖ Megold√°s:</strong><br>
            Feh√©r fest√©k (255, 255, 255) √∂bl√≠t√©se a piros folt (500, 500) poz√≠ci√≥j√°ra, √≠gy az feh√©r h√°tt√©ren l√°thatatlann√° v√°lik.
        </div>

        <p><strong>Id≈ëz√≠t√©si strat√©gia:</strong></p>
        <div class="timeline">
            <div class="timeline-item">
                <strong>t=0ms:</strong> activate() h√≠v√°s ‚Üí piros folt gener√°l√≥dik (500, 500)
            </div>
            <div class="timeline-item">
                <strong>t=100ms:</strong> Feh√©r fest√©k √∂bl√≠t√©s (500, 500) ‚Üí piros folt elnyomva
            </div>
            <div class="timeline-item">
                <strong>t=300ms:</strong> T√ºrkiz splat #1 (v√©letlenszer≈± poz√≠ci√≥)
            </div>
            <div class="timeline-item">
                <strong>t=500ms:</strong> Lila splat #2 (v√©letlenszer≈± poz√≠ci√≥)
            </div>
            <div class="timeline-item">
                <strong>t=700ms:</strong> Kir√°lyk√©k splat #3 (v√©letlenszer≈± poz√≠ci√≥)
            </div>
        </div>

        <p><strong>Elv√°rt viselked√©s:</strong></p>
        <ul>
            <li>‚úÖ <strong>Piros folt l√°thatatlan</strong> (feh√©rrel elnyomva)</li>
            <li>‚úÖ <strong>3 sz√≠nes folt</strong> jelenik meg (t√ºrkiz, lila, kir√°lyk√©k)</li>
            <li>‚úÖ <strong>Nagyobb amplit√∫d√≥</strong> (1500px, 15%-a = 225px mozg√°s)</li>
            <li>‚úÖ <strong>Er≈ësebb h√∫z√°s</strong> (80ms mousedown-mouseup)</li>
        </ul>

        <p><strong>Teszteld:</strong></p>
        <ul>
            <li>V√°rd meg az oldal bet√∂lt√©s√©t (~1 m√°sodperc)</li>
            <li>N√©zd a jobb fels≈ë sarokban a debug konzolt</li>
            <li>Ellen≈ërizd: L√°tszik-e piros folt? (NEM kellene!)</li>
            <li>Mozgasd az egeret - √∫j sz√≠nes foltok jelennek meg</li>
            <li>F12 ‚Üí Console - r√©szletes id≈ëz√≠t√©si logok</li>
        </ul>

        <div class="info-box" style="border-left-color: #4CAF50; background: rgba(76, 175, 80, 0.1);">
            <strong>üéØ Forr√°s elemz√©s:</strong><br>
            A piros folt forr√°sa megtal√°lva az eredeti Fluid-JS k√≥dban:<br>
            <code>src/initializer.js:284</code> - multipleSplats() h√≠v√°s<br>
            <code>src/initializer.js:694-703</code> - hardcoded piros sz√≠n {r:255, g:0, b:0}
        </div>
    </div>

    <!-- Fluid-JS UNAS integr√°ci√≥ k√≥d (TELJES) -->
    <script>
        // Debug logging f√ºggv√©ny
        function debugLog(message, type = 'info') {
            const debugPanel = document.getElementById('debugLog');
            const item = document.createElement('div');
            item.className = `debug-item ${type}`;
            const timestamp = new Date().toLocaleTimeString('hu-HU', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                fractionalSecondDigits: 3
            });
            item.textContent = `[${timestamp}] ${message}`;
            debugPanel.appendChild(item);

            // Automatikus scroll
            debugPanel.scrollTop = debugPanel.scrollHeight;

            // Console is
            if (type === 'error') {
                console.error(message);
            } else if (type === 'success') {
                console.log('‚úÖ ' + message);
            } else if (type === 'warning') {
                console.warn('‚ö†Ô∏è ' + message);
            } else {
                console.log(message);
            }
        }

        // =============================================================================
        // FLUID-JS UNAS INTEGR√ÅCI√ì - FEH√âR FEST√âK √ñBL√çT√âS
        // =============================================================================
        (function(){
            debugLog('Script ind√≠t√°sa...', 'info');

            // 1. GLOB√ÅLIS CANVAS L√âTREHOZ√ÅSA
            window.canvas = document.createElement('canvas');
            window.canvas.id = 'renderSurface';
            window.canvas.width = window.innerWidth;
            window.canvas.height = window.innerHeight;
            window.canvas.style.cssText = 'display:block;width:100vw;height:100vh;position:fixed;top:0;left:0;z-index:-1';
            document.body.insertBefore(window.canvas, document.body.firstChild);
            debugLog('Canvas l√©trehozva: ' + window.canvas.width + 'x' + window.canvas.height, 'success');

            // 2. FLUID-JS CDN BET√ñLT√âSE
            var script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/fluid-canvas@latest';
            debugLog('Fluid-JS CDN bet√∂lt√©se...', 'info');

            script.onload = function() {
                debugLog('Fluid-JS CDN bet√∂ltve', 'success');

                // ELS≈ê TIMEOUT: 500ms v√°rakoz√°s
                setTimeout(function() {
                    if (typeof Fluid === 'undefined') {
                        debugLog('Fluid library nem el√©rhet≈ë!', 'error');
                        return;
                    }

                    var canvasElement = document.getElementById('renderSurface');
                    debugLog('Canvas elem lek√©rve: #renderSurface', 'success');

                    try {
                        // 3. FLUID P√âLD√ÅNY L√âTREHOZ√ÅSA
                        var myFluid = new Fluid(canvasElement);
                        debugLog('Fluid p√©ld√°ny l√©trehozva', 'success');

                        // 4. FLUID PARAM√âTEREK BE√ÅLL√çT√ÅSA
                        myFluid.mapBehaviors({
                            sim_resolution: 128,
                            dye_resolution: 512,
                            dissipation: 0.98,
                            velocity: 0.99,
                            pressure: 0.8,
                            pressure_iteration: 20,
                            curl: 30,
                            emitter_size: 0.5,
                            render_shaders: true,
                            multi_color: false,
                            render_bloom: false,
                            background_color: { r: 255, g: 255, b: 255 },
                            transparent: false
                        });
                        debugLog('Fluid param√©terek be√°ll√≠tva', 'success');

                        // M√ÅSODIK TIMEOUT: 300ms v√°rakoz√°s
                        setTimeout(function() {
                            // 5. ANIM√ÅCI√ì AKTIV√ÅL√ÅSA (Ez gener√°lja a piros foltot!)
                            debugLog('‚ö†Ô∏è activate() h√≠v√°s - piros folt gener√°l√≥dik...', 'warning');
                            myFluid.activate();
                            debugLog('Fluid aktiv√°lva', 'success');

                            // 5.5. PIROS FOLT ELT√úNTET√âSE (KRITIKUS!)
                            setTimeout(function() {
                                debugLog('üßπ Feh√©r fest√©k √∂bl√≠t√©s ind√≠t√°sa...', 'warning');

                                // Feh√©r sz√≠n be√°ll√≠t√°sa
                                myFluid.color = { r: 255, g: 255, b: 255 };

                                // Nagy feh√©r folt gener√°l√°sa a piros folt f√∂l√© (500, 500 poz√≠ci√≥)
                                canvasElement.dispatchEvent(new MouseEvent('mousedown', {
                                    clientX: 500,
                                    clientY: 500,
                                    bubbles: true
                                }));

                                setTimeout(function() {
                                    canvasElement.dispatchEvent(new MouseEvent('mouseup', {
                                        clientX: 500,
                                        clientY: 500,
                                        bubbles: true
                                    }));
                                    debugLog('‚úÖ Feh√©r fest√©k felhordva (500, 500) - piros folt elnyomva', 'success');
                                }, 30);
                            }, 100);

                            // 6. KEZDETI SPLAT-OK GENER√ÅL√ÅSA
                            var initialColors = [
                                { r: 0, g: 255, b: 255 },           // T√ºrkiz
                                { r: 204, g: 51, b: 255 },          // Lila
                                { r: 0, g: 128, b: 255 }            // Kir√°lyk√©k
                            ];
                            var colorNames = ['T√ºrkiz', 'Lila', 'Kir√°lyk√©k'];

                            debugLog('Sz√≠nes splat-ok gener√°l√°sa (300ms-500ms-700ms)...', 'info');

                            for (var i = 0; i < 3; i++) {
                                (function(index) {
                                    setTimeout(function() {
                                        var x = (0.2 + Math.random() * 0.6) * window.innerWidth;
                                        var y = (0.2 + Math.random() * 0.6) * window.innerHeight;
                                        var dx = (Math.random() - 0.5) * 1500;
                                        var dy = (Math.random() - 0.5) * 1500;

                                        myFluid.color = initialColors[index];
                                        debugLog(`üé® Splat #${index + 1} (${colorNames[index]}) @ (${Math.round(x)}, ${Math.round(y)})`, 'success');

                                        canvasElement.dispatchEvent(new MouseEvent('mousedown', {
                                            clientX: x,
                                            clientY: y,
                                            bubbles: true
                                        }));

                                        setTimeout(function() {
                                            canvasElement.dispatchEvent(new MouseEvent('mouseup', {
                                                clientX: x + dx * 0.15,
                                                clientY: y + dy * 0.15,
                                                bubbles: true
                                            }));
                                        }, 80);
                                    }, 300 + index * 200);
                                })(i);
                            }

                            // 7. EG√âRK√ñVET√âS V√ÅLTOZ√ìI
                            var lastX = -1, lastY = -1;
                            var moveCounter = 0;
                            var isSimulating = false;

                            // 8. SZ√çNPALETTA
                            var colors = [
                                { r: 0, g: 255, b: 255 },
                                { r: 204, g: 51, b: 255 },
                                { r: 0, g: 128, b: 255 }
                            ];

                            // 9. EG√âRMOZG√ÅS ESEM√âNYKEZEL≈ê
                            canvasElement.addEventListener('mousemove', function(e) {
                                if (isSimulating || !e.isTrusted) return;

                                var x = e.clientX, y = e.clientY;

                                if (lastX !== -1 && lastY !== -1) {
                                    var dx = x - lastX;
                                    var dy = y - lastY;
                                    var speed = Math.sqrt(dx * dx + dy * dy);

                                    moveCounter++;

                                    if (speed > 3 && moveCounter % 3 === 0) {
                                        isSimulating = true;

                                        myFluid.color = colors[Math.floor(Math.random() * 3)];

                                        canvasElement.dispatchEvent(new MouseEvent('mousedown', {
                                            clientX: x,
                                            clientY: y,
                                            bubbles: true
                                        }));

                                        setTimeout(function() {
                                            canvasElement.dispatchEvent(new MouseEvent('mouseup', {
                                                clientX: x + dx,
                                                clientY: y + dy,
                                                bubbles: true
                                            }));
                                            isSimulating = false;
                                        }, 20);
                                    }
                                }

                                lastX = x;
                                lastY = y;
                            }, {passive: true});

                            debugLog('Eg√©rmozg√°s esem√©nykezel≈ë aktiv√°lva', 'success');
                            debugLog('‚úÖ INICIALIZ√ÅL√ÅS K√âSZ - Mozgasd az egeret!', 'success');

                        }, 300);

                    } catch (error) {
                        debugLog('Hiba: ' + error.message, 'error');
                        console.error('Stack trace:', error.stack);
                    }
                }, 500);
            };

            script.onerror = function() {
                debugLog('Fluid-JS CDN bet√∂lt√©si hiba!', 'error');
            };

            document.head.appendChild(script);
        })();
    </script>
</body>
</html>
